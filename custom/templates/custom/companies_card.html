{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}{{ title }}{% endblock %}

{% block vendor_css %}
  {{ block.super }}

{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}



  <script src="{% static 'vendor/libs/jquery-repeater/jquery-repeater.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  {{ block.super }}
  <script>

    // bootstrap-maxlength & repeater (jquery)
    $(function() {
      let formRepeater = $('.form-repeater');

      if (formRepeater.length) {
        let row = 2;
        let col = 1;
        formRepeater.on('submit', function(e) {
          e.preventDefault();
        });
        formRepeater.repeater({
          show: function() {
            let fromControl = $(this).find('.form-control, .form-select');
            let formLabel = $(this).find('.form-label');

            fromControl.each(function(i) {
              let id = 'form-repeater-' + row + '-' + col;
              $(fromControl[i]).attr('id', id);
              $(formLabel[i]).attr('for', id);
              col++;
            });

            row++;

            $(this).slideDown();
          },
          hide: function(e) {
            confirm('Ви дійсно хочете видалити цей едлемент?') && $(this).slideUp(e);
          }
        });
      }
    });


  </script>
{% endblock page_js %}

{% block content %}
  <div class="row">

    <div class="row my-6">
      <div class="col">
        <h2> Карточка компанії </h2>
        <div class="accordion" id="collapsibleSection">
          <div class="accordion-item active">
            <h2 class="accordion-header" id="headingCompany">
              <button type="button" class="accordion-button" data-bs-toggle="collapse"
                      data-bs-target="#collapseCompany" aria-expanded="true"
                      aria-controls="collapseCompany"> Компанія
              </button>
            </h2>
            <div id="collapseCompany" class="accordion-collapse collapse show"
                 data-bs-parent="#collapsibleSection">
              <div class="accordion-body">
                <div class="row g-6">

                  {% csrf_token %}
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.full_name }}
                      <label for="{{ form.full_name.id_for_label }}">{{ form.full_name.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.name }}
                      <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.okpo }}
                      <label for="{{ form.okpo.id_for_label }}">{{ form.okpo.label }}</label>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.delivery_preset }}
                      <label for="{{ form.delivery_preset.id_for_label }}">{{ form.delivery_preset.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.number }}
                      <label for="{{ form.number.id_for_label }}">{{ form.number.label }}</label>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.company_group }}
                      <label for="{{ form.company_group.id_for_label }}">{{ form.company_group.label }}</label>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form.contact }}
                      <label for="{{ form.contact.id_for_label }}"></label>
                    </div>
                  </div>

                  <div class="col-md-12">

                    <div class="form-check form-switch mb-2">
                      {{ form.is_verified }}
                      <label class="form-check-label"
                             for="{{ form.is_verified.id_for_label }}">{{ form.is_verified.label }}</label>
                    </div>

                  </div>

                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form.is_verified }}
                      <label class="form-check-label"  for="{{ form.is_outdated.id_for_label }}">{{ form.is_outdated.label }}</label>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form.is_client }}
                      <label class="form-check-label"  for="{{ form.is_client.id_for_label }}">{{ form.is_client.label }}</label>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form.is_printing_company }}
                      <label class="form-check-label"  for="{{ form.is_printing_company.id_for_label }}">{{ form.is_printing_company.label }}</label>
                    </div>
                  </div>

                </div>
                <div class="mt-5">

                  <button type="submit" class="btn btn-primary me-4">{% if form.instance.pk %} Зберегти зміни {% else %} Додати компанію {% endif %}</button>
                  <button type="reset" class="btn btn-outline-secondary">Відмінити</button>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingCompanyClient">
              <button type="button" class="accordion-button" data-bs-toggle="collapse"
                      data-bs-target="#collapseCompanyClient" aria-expanded="true"
                      aria-controls="collapseCompanyClient"> Замовник
              </button>
            </h2>
            <div id="collapseCompanyClient" class="accordion-collapse collapse"
                 data-bs-parent="#collapsibleSection">
              <div class="accordion-body">
              {% csrf_token %}
               {% for form_clients_formset in form.clients_formset %}

                <div class="row g-6">
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form_clients_formset.company_our_brand }}
                      <label for="{{ form_clients_formset.company_our_brand.id_for_label }}">{{ form_clients_formset.company_our_brand.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form_clients_formset.is_banned }}
                      <label class="form-check-label"  for="{{ form_clients_formset.is_banned.id_for_label }}">{{ form_clients_formset.is_banned.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form_clients_formset.debt }}
                      <label class="form-check-label"  for="{{ form_clients_formset.debt.id_for_label }}">{{ form_clients_formset.debt.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form_clients_formset.document_delivery_type }}
                      <label class="form-check-label"  for="{{ form_clients_formset.document_delivery_type.id_for_label }}">{{ form_clients_formset.document_delivery_type.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form_clients_formset.is_prepayment }}
                      <label class="form-check-label"  for="{{ form_clients_formset.is_prepayment.id_for_label }}">{{ form_clients_formset.is_prepayment.label }}</label>
                    </div>
                  </div>
                </div>
                <div class="mt-5">

            {% endfor %}

                  <button type="submit" class="btn btn-primary me-4">Зберегти зміни</button>
                  <button type="reset" class="btn btn-outline-secondary">Відмінити</button>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingPrintingCompany">
              <button type="button" class="accordion-button" data-bs-toggle="collapse"
                      data-bs-target="#collapsePrintingCompany" aria-expanded="true"
                      aria-controls="collapsePrintingCompany"> Друкарська компанія
              </button>
            </h2>
            <div id="collapsePrintingCompany" class="accordion-collapse collapse"
                 data-bs-parent="#collapsibleSection">
              <div class="accordion-body">
              {% csrf_token %}
               {% for form_printing_companies_formset in form.printing_company_formset %}

                <div class="row g-6">
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form_printing_companies_formset.process_id }}
                      <label for="{{ form_printing_companies_formset.process_id.id_for_label }}">{{ form_printing_companies_formset.process_id.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-floating form-floating-outline">
                      {{ form_printing_companies_formset.color_library }}
                      <label class="form-check-label"  for="{{ form_printing_companies_formset.color_library.id_for_label }}">{{ form_printing_companies_formset.color_library.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form_printing_companies_formset.need_printout }}
                      <label class="form-check-label"  for="{{ form_printing_companies_formset.need_printout.id_for_label }}">{{ form_printing_companies_formset.need_printout.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form_printing_companies_formset.use_low_base }}
                      <label class="form-check-label"  for="{{ form_printing_companies_formset.use_low_base.id_for_label }}">{{ form_printing_companies_formset.use_low_base.label }}</label>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-check form-switch mb-2">
                      {{ form_printing_companies_formset.need_label }}
                      <label class="form-check-label"  for="{{ form_printing_companies_formset.need_label.id_for_label }}">{{ form_printing_companies_formset.need_label.label }}</label>
                    </div>
                  </div>
                </div>
                <div class="mt-5">

            {% endfor %}

                  <button type="submit" class="btn btn-primary me-4">Зберегти зміни</button>
                  <button type="reset" class="btn btn-outline-secondary">Відмінити</button>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingDeliveryOptions">
              <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                      data-bs-target="#collapseDeliveryOptions" aria-expanded="false"
                      aria-controls="collapseDeliveryOptions"> Контакти компанії
              </button>
            </h2>
            <div id="collapseDeliveryOptions" class="accordion-collapse collapse"
                 aria-labelledby="headingDeliveryOptions" data-bs-parent="#collapsibleSection">
              <div class="accordion-body">
                <div class="row">
  <form method="post" class="form-repeater">
    {% csrf_token %}
    {{ form.company_contacts_formset.management_form }}
    <div data-repeater-list="company-contacts">
      {% for form in form.company_contacts_formset %}
      <div data-repeater-item>
        <div class="row">
          <!-- Поле Contact -->
          <div class="mb-6 col-lg-6 col-xl-3 col-12 mb-0">
            <div class="form-floating form-floating-outline">
              {{ form.contact }}
              <label for="{{ form.contact.id_for_label }}">{{ form.contact.label }}</label>
            </div>
          </div>
          <!-- Поле Position -->
          <div class="mb-6 col-lg-6 col-xl-3 col-12 mb-0">
            <div class="form-floating form-floating-outline">
              {{ form.position }}
              <label for="{{ form.position.id_for_label }}">{{ form.position.label }}</label>
            </div>
          </div>
          <!-- Поле Is Logistic -->
          <div class="mb-6 col-lg-6 col-xl-2 col-12 mb-0">
            <div class="form-check form-switch mb-2">
              {{ form.is_logistic }}
              <label for="{{ form.is_logistic.id_for_label }}">{{ form.is_logistic.label }}</label>
            </div>
          </div>
          <!-- Поле Comment -->
          <div class="mb-6 col-lg-6 col-xl-2 col-12 mb-0">
            <div class="form-floating form-floating-outline">
              {{ form.comment }}
              <label for="{{ form.comment.id_for_label }}">{{ form.comment.label }}</label>
            </div>
          </div>
          <!-- Удаление -->
          <div class="mb-6 col-lg-12 col-xl-2 col-12 d-flex align-items-center mb-0">

            <button class="btn btn-outline-danger btn-xl" data-repeater-delete>
              <i class="ri-close-line ri-24px me-1"></i>
              <span class="align-middle">Видалити</span>
            </button>
          </div>
        </div>
        <hr class="mt-0">
      </div>
      {% endfor %}
    </div>
    <!-- Кнопка для добавления -->
    <div class="mb-0">
      <button class="btn btn-primary" data-repeater-create>
        <i class="ri-add-line me-1"></i>
        <span class="align-middle">Додати</span>
      </button>

        <button type="submit" class="btn btn-primary me-4">Зберегти</button>
    </div>
  </form>
</div>

              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingDeliveryOptions">
              <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                      data-bs-target="#collapseDeliveryOptions" aria-expanded="false"
                      aria-controls="collapseDeliveryOptions"> Контакти компанії
              </button>
            </h2>
            <div id="collapseDeliveryOptions" class="accordion-collapse collapse"
                 aria-labelledby="headingDeliveryOptions" data-bs-parent="#collapsibleSection">
              <div class="accordion-body">
                <div class="row">
  <form method="post" class="form-repeater">
    {% csrf_token %}
    {{ form.company_contacts_formset.management_form }}
    <div data-repeater-list="company-contacts">
      {% for form in form.company_contacts_formset %}
      <div data-repeater-item>
        <div class="row">
          <!-- Поле Contact -->
          <div class="mb-6 col-lg-6 col-xl-3 col-12 mb-0">
            <div class="form-floating form-floating-outline">
              {{ form.contact }}
              <label for="{{ form.contact.id_for_label }}">{{ form.contact.label }}</label>
            </div>
          </div>
          <!-- Поле Position -->
          <div class="mb-6 col-lg-6 col-xl-3 col-12 mb-0">
            <div class="form-floating form-floating-outline">
              {{ form.position }}
              <label for="{{ form.position.id_for_label }}">{{ form.position.label }}</label>
            </div>
          </div>
          <!-- Поле Is Logistic -->
          <div class="mb-6 col-lg-6 col-xl-2 col-12 mb-0">
            <div class="form-check form-switch mb-2">
              {{ form.is_logistic }}
              <label for="{{ form.is_logistic.id_for_label }}">{{ form.is_logistic.label }}</label>
            </div>
          </div>
          <!-- Поле Comment -->
          <div class="mb-6 col-lg-6 col-xl-2 col-12 mb-0">
            <div class="form-floating form-floating-outline">
              {{ form.comment }}
              <label for="{{ form.comment.id_for_label }}">{{ form.comment.label }}</label>
            </div>
          </div>
          <!-- Удаление -->
          <div class="mb-6 col-lg-12 col-xl-2 col-12 d-flex align-items-center mb-0">

            <button class="btn btn-outline-danger btn-xl" data-repeater-delete>
              <i class="ri-close-line ri-24px me-1"></i>
              <span class="align-middle">Видалити</span>
            </button>
          </div>
        </div>
        <hr class="mt-0">
      </div>
      {% endfor %}
    </div>
    <!-- Кнопка для добавления -->
    <div class="mb-0">
      <button class="btn btn-primary" data-repeater-create>
        <i class="ri-add-line me-1"></i>
        <span class="align-middle">Додати</span>
      </button>

        <button type="submit" class="btn btn-primary me-4">Зберегти</button>
    </div>
  </form>
</div>

              </div>
            </div>
          </div>

        </div>
      </div>

      {% if form.printing_machines_formset %}
        <h3>Printing Machines</h3>
        {{ form.printing_machines_formset.management_form }}
        {% for formset_form in form.printing_machines_formset %}
            <div class="form-group">
                {{ formset_form.name.label_tag }} {{ formset_form.name }}
            </div>
            <div class="form-group">
                {{ formset_form.section.label_tag }} {{ formset_form.section }}
            </div>
            <div class="form-group">
                {{ formset_form.module.label_tag }} {{ formset_form.module }}
            </div>
            <div class="form-group">
                {{ formset_form.fartuk.label_tag }} {{ formset_form.fartuk }}
            </div>
            {{ formset_form.DELETE }}
            <hr>
        {% endfor %}
    {% endif %}


    </div>


  </div>
{% endblock %}
